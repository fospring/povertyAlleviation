<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>XX市精准帮扶工程区块链应用系统</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <link rel="stylesheet" href="../../../bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../../../bower_components/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="../../../bower_components/Ionicons/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../../../dist/css/AdminLTE.css">
  <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
        page. However, you can choose any other skin. Make sure you
        apply the skin class to the body tag so the changes take effect. -->
  <link rel="stylesheet" href="../../../dist/css/skins/skin-blue.min.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Google Font -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
  <link rel="stylesheet" href="../../../dist/css/mycss.css">
  <script src="../../../dist/js/myjs.js"></script>
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to get the
desired effect
|---------------------------------------------------------|
| SKINS         | skin-blue                               |
|               | skin-black                              |
|               | skin-purple                             |
|               | skin-yellow                             |
|               | skin-red                                |
|               | skin-green                              |
|---------------------------------------------------------|
|LAYOUT OPTIONS | fixed                                   |
|               | layout-boxed                            |
|               | layout-top-nav                          |
|               | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->
<body class="hold-transition skin-blue sidebar-mini">
<!-- Modal -->
<div class="modal fade bs-example-modal-lg" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">低保帮扶名单</h4>
      </div>
      <div class="modal-body">
      <table class="table table-hover c" id="targetTable">
         <thead>
          <tr>
            <th>选择</th>
            <th>申请单号</th>
            <th>身份证号</th>
            <th>姓名</th>
            <th>家庭人数</th>
            <th>人均收入</th>
            <th>申请原因</th>
            <th>所属民政局</th>
          </tr>
        </thead>
        <tbody id="list"></tbody>
      </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" onclick="choice();" data-dismiss="modal">确定</button>
      </div>
    </div>
  </div>
</div>
<div class="wrapper">

  <!-- Main Header -->
  <header class="main-header">
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        首页
        <small>>进行捐赠</small>
      </h1>
    </section>

    <!-- Main content -->
    <section class="content container-fluid">

      <!--------------------------
        | Your Page Content Here |
        -------------------------->
        <!--coded By Bobo 2017/7/13-->
      <div class="box">    
        <div class="box-body">

<div>
  <!-- Nav tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">捐赠详情</a></li>
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
      <br>
          <form class="form-horizontal">
            <div class="form-group form-group-sm">
              <label for="belongs" class="col-sm-2 control-label">捐赠物品</label>
              <div class="col-sm-3">
                 <select class="form-control" name="belongs" id="goodsName">
                  <option selected value="化肥">化肥</option>
                  <option value="农药">农药</option>
                  <option value="农具">农具</option>
                </select>
              </div>
              <label for="status" class="col-sm-2 control-label">物品单价</label>
              <div class="col-sm-3">
                 <input type="text" name="username" class="form-control" value="0" id="goodsPrice" readonly>
              </div>
            </div> 
            <div class="form-group form-group-sm">
              <label for="belongs" class="col-sm-2 control-label">捐赠数量</label>
              <div class="col-sm-3">
                 <select class="form-control" name="belongs" id="goodsNum">
                  <option selected value=0>0</option>
                  <option value=1>1</option>
                  <option value=100>100</option>
                  <option value=500>500</option>
                  <option value=1000>1000</option>
                </select>
              </div>
            </div> 
            <div class="form-group form-group-sm">
              <label for="status" class="col-sm-2 control-label">捐赠现金</label>
              <div class="col-sm-3">
                <div class="input-group">
                  <input type="text" class="form-control" id="money" value="0" aria-describedby="basic-addon2">
                  <span class="input-group-addon" id="basic-addon2">元</span>
                </div>
              </div>
            </div>  
            <div class="form-group form-group-sm">
              <label for="status" class="col-sm-2 control-label">折合金额</label>
              <div class="col-sm-3">
                <div class="input-group">
                  <input type="text" class="form-control" id="goodsValues" aria-describedby="basic-addon2" readonly>
                  <span class="input-group-addon" id="basic-addon2">元</span>
                </div>
              </div>
            </div>  
            <div class="form-group form-group-sm">
              <label for="belongs" class="col-sm-2 control-label">选择受捐名单</label>
              <div class="col-sm-2">                 
                 <a class="btn btn-primary btn-sm btn-block" data-toggle="modal" data-target="#myModal">低保帮扶名单</a>
              </div>
            </div>     
            <div class="form-group form-group-sm">
              <label for="belongs" class="col-sm-2 control-label">受捐人信息</label>
              <div class="col-sm-10">                 
                 <p id="showpeople">未选择</p> 
              </div>
            </div>         
            <div class="form-group form-group-sm">
              <label for="status" class="col-sm-2 control-label">捐赠说明</label>
              <div class="col-sm-8">
                <textarea class="form-control" id="comment" value="无" rows="3">无</textarea>
              </div>
            </div>
          <div class="col-md-offset-4 col-md-2">
            <a class="btn btn-primary btn-sm btn-block" onclick="donate();">捐赠</a>
          </div>
          <div class="col-md-2">
            <button type="reset" class="btn btn-default btn-sm btn-block">取消</button>
          </div>
          </form>
  </div>

</div>
        </div>
        <!-- /.box-body -->
      </div>
          </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Main Footer -->
  <footer class="main-footer">    
  </footer>
  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Create the tabs -->
    <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
      <li class="active"><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
      <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">
      <!-- Settings tab content -->
      <div class="tab-pane" id="control-sidebar-settings-tab">
        <form method="post">
          <h3 class="control-sidebar-heading">General Settings</h3>

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Report panel usage
              <input type="checkbox" class="pull-right" checked>
            </label>

            <p>
              Some information about this general settings option
            </p>
          </div>
          <!-- /.form-group -->
        </form>
      </div>
      <!-- /.tab-pane -->
    </div>
  </aside>
  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
  immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- REQUIRED JS SCRIPTS -->

<!-- jQuery 3 -->
<script src="../../../bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="../../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- AdminLTE App -->
<script src="../../../dist/js/adminlte.js"></script>
<script src="../../../dist/js/myjs.js"></script>
<script src="../../../dist/js/moment.js"></script>
<!-- Optionally, you can add Slimscroll and FastClick plugins.
     Both of these plugins are recommended to enhance the
     user experience. -->
  <script>
  /*
   *加载header、sider和footer
  */
    $(".main-header").load("../mainheader.html"); 
    $(".main-sidebar").load("../mainsider.html");
    $(".main-footer").load("../../mainfooter.html"); 
/*
*
*/
$(document).ready(function(){
  var gn;
  $('#goodsName').change(function() {
    gn=$('#goodsName').val();
    if(gn=='化肥'){
      $('#goodsPrice').val('50元');
      total=50*$('#goodsNum').val()+1*$('#money').val();
      $('#goodsValues').val(total);
    }else if(gn=='农药'){
      $('#goodsPrice').val('20元');
      total=20*$('#goodsNum').val()+1*$('#money').val();
      $('#goodsValues').val(total);
    }else{
      $('#goodsPrice').val('500元');
      total=500*$('#goodsNum').val()+1*$('#money').val();
      $('#goodsValues').val(total);
    }
  });
  $('#money').change(function() {
    gn=$('#goodsName').val();
    var total;
    if(gn=='化肥'){
      total=50*$('#goodsNum').val()+1*$('#money').val();
      $('#goodsValues').val(total);
    }else if(gn=='农药'){
      total=20*$('#goodsNum').val()+1*$('#money').val();
      $('#goodsValues').val(total);
    }else{
      total=500*$('#goodsNum').val()+1*$('#money').val();
      $('#goodsValues').val(total);
    }
  });
  $("#upload").click(function(){
    $("#material1").show();
  });

/**/
  var postBody = {
      ChId: getCookie("ChId")
  };
  $.ajax({
      type: 'POST',
      url: 'http://localhost:3000/dbtest/charityAdmin/find',
      data: postBody,
      dataType: 'json',
      success: function(data){        
          var jsonstr=JSON.stringify(data);
          console.log(jsonstr); 
          for(var o in data){
              $('<tr>'
              +'<td><input type="radio" name="choice" value="'+o+'" id="'+o+'"></td>'
              +'<td id="_id'+o+'">'+data[o]._id+'</td>'
              +'<td id="userId'+o+'">'+data[o].userId+'</td>'
              +'<td id="name'+o+'">'+data[o].name+'</td>'
              +'<td id="familyNum'+o+'">'+data[o].familyNum+'</td>'
              +'<td id="averageIncome'+o+'">'+data[o].averageIncome+'</td>'
              +'<td id="reason'+o+'">'+data[o].reason+'</td>'
              +'<td id="ciId'+o+'">'+data[o].civilAffairsId+'</td>'
              +'<td id="id'+o+'" style="display:none;">'+data[o].id+'</td>'
             +'</tr>').appendTo("#list");
              //alert(data[o].id)
          }
          if($("#list").html()==""){
            $("#list").html('<span style="color:#3c8dbc;">暂无低保帮扶记录。</span>');
          }
      }
  }).error(function(err){
      console.log(err);
      alert("错误："+err.responseText);
  });  
});

function choice(){
  var num = $('input[name="choice"]:checked ').val();
  var _id = "#_id"+num;
  var name="#name"+num;
  var userId = "#userId"+num;
  var reason = "#reason"+num;
  var ciId ="#ciId"+num;
  var id = "#id"+num;
  $("#showpeople").html('申请单号:<span id="_id">'+$(_id).html()+'</span><br>'
    +' 低保帮扶对象姓名:<span id="name">'+$(name).html()+'</span><br>'
    +'身份证号:<span id="userId">'+$(userId).html()+'</span><br>'+'申请原因:<span id="reason">'+$(reason).html()+'</span><br>'
    +'所属民政局:<span id="ciId">'+$(ciId).html()+'</span><span id="id" style="display:none;">'+$(id).html()+'</span>');
}
// 
function donate(){
  var postBody = {
      _id:$("#_id").html(),
      chId: getCookie("ChId"),
      id:$("#id").html(),
      userId:getCookie("chauserId"),
      appUserId:$("#userId").html(),
      reason:$("#reason").html(),
      ciId:$("#ciId").html(),
      comment:$("#comment").html(),
      amount:$("#goodsValues").val()
  };
  alert(JSON.stringify(postBody));
  $.ajax({
      type: 'POST',
      url: 'http://localhost:3000/dbtest/charity/donate',
      data: postBody,
      dataType: 'json',
      success: function(data){      
          alert('捐赠成功！');
          //window.location.href=""
      }
  }).error(function(err){
      console.log(err);
      alert("错误："+err.responseText);
  });  
}

  </script>
</body>
</html>