<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>XX市精准帮扶工程区块链应用系统</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <link rel="stylesheet" href="../../../bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../../../bower_components/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="../../../bower_components/Ionicons/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../../../dist/css/AdminLTE.css">
  <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
        page. However, you can choose any other skin. Make sure you
        apply the skin class to the body tag so the changes take effect. -->
  <link rel="stylesheet" href="../../../dist/css/skins/skin-blue.min.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Google Font -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
  <link rel="stylesheet" href="../../../dist/css/mycss.css">
  <script src="../../../dist/js/myjs.js"></script>
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to get the
desired effect
|---------------------------------------------------------|
| SKINS         | skin-blue                               |
|               | skin-black                              |
|               | skin-purple                             |
|               | skin-yellow                             |
|               | skin-red                                |
|               | skin-green                              |
|---------------------------------------------------------|
|LAYOUT OPTIONS | fixed                                   |
|               | layout-boxed                            |
|               | layout-top-nav                          |
|               | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  <!-- Main Header -->
  <header class="main-header">
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        首页
        <small>>接收捐赠</small>
      </h1>
    </section>

    <!-- Main content -->
    <section class="content container-fluid">

      <!--------------------------
        | Your Page Content Here |
        -------------------------->
        <!--coded By Bobo 2017/7/13-->
      <div class="box"> 
        <div class="box-body">
<div>
  <!-- Nav tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">确认收到捐赠</a></li>
    <li role="presentation"><a href="#allhandle" aria-controls="profile" role="tab" data-toggle="tab">处理记录</a></li>
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="home">
          <table class="table table-hover c">
           <thead>
            <tr>
              <th>捐赠单号</th>
              <th>慈善机构</th>
              <th>折合金额（元）</th>
              <th>民政局</th>
              <th>捐赠时间</th>
              <th>捐赠原因</th>
              <th>慈善机构评论</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody id="accept"></tbody>
        </table>
    </div>
    <div role="tabpanel" class="tab-pane" id="allhandle">
          <table class="table table-hover c">
           <thead>
            <tr>
              <th>捐赠单号</th>
              <th>慈善机构</th>
              <th>折合金额（元）</th>
              <th>民政局</th>
              <th>捐赠时间</th>
              <th>捐赠原因</th>
              <th>慈善机构评论</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody id="allHandleRecord"></tbody>
        </table>
    </div>
    </div>
  </div>

</div>
        </div>
        <!-- /.box-body -->
      </div>
          </section>
    <!-- /.content -->
  <!-- /.content-wrapper -->

  <!-- Main Footer -->
  <footer class="main-footer">    
  </footer>
  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Create the tabs -->
    <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
      <li class="active"><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
      <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">
      <!-- Settings tab content -->
      <div class="tab-pane" id="control-sidebar-settings-tab">
        <form method="post">
          <h3 class="control-sidebar-heading">General Settings</h3>

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Report panel usage
              <input type="checkbox" class="pull-right" checked>
            </label>

            <p>
              Some information about this general settings option
            </p>
          </div>
          <!-- /.form-group -->
        </form>
      </div>
      <!-- /.tab-pane -->
    </div>
  </aside>
  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
  immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- REQUIRED JS SCRIPTS -->

<!-- jQuery 3 -->
<script src="../../../bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="../../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- AdminLTE App -->
<script src="../../../dist/js/adminlte.js"></script>
<script src="../../../dist/js/myjs.js"></script>
<script src="../../../dist/js/moment.js"></script>
<!-- Optionally, you can add Slimscroll and FastClick plugins.
     Both of these plugins are recommended to enhance the
     user experience. -->
  <script>
  /*
   *加载header、sider和footer
  */
    $(".main-header").load("../mainheader.html"); 
    $(".main-sidebar").load("../mainsider.html");
    $(".main-footer").load("../../mainfooter.html"); 
/*
*
*/
$(document).ready(function(){
  $("#material1").hide();
  $("#upload").click(function(){
    $("#material1").show();
  });
  $("#dmaterial1").click(function(){
    $("#material1").hide();
  });
 var postBody = {
      appUserId: getCookie("userId")
  };
  $.ajax({
      type: 'POST',
      url: 'http://localhost:3000/dbtest/lowincome/find',
      data: postBody,
      dataType: 'json',
      success: function(data){        
          for(var o in data){
            if(data[o].status=="2"){
              $('<tr>'
              +'<td id="_id'+o+'">'+data[o]._id+'</td>'
              +'<td id="chId'+o+'">'+data[o].chId+'</td>'
              +'<td id="amount'+o+'">'+data[o].amount+'</td>'
              +'<td id="ciId'+o+'">'+data[o].ciId+'</td>'
              +'<td id="createAt'+o+'">'+moment(data[o].createAt).format('YYYY-MM-DD')+'</td>'
              +'<td id="reason'+o+'">'+data[o].reason+'</td>'
              +'<td id="comment'+o+'">'+data[o].comment+'</td>'
              +'<td><span id="choice'+o+'"><a class="btn btn-info" id="'+o+'" onclick="agree(this)">确认无误</a>'
              +' <a class="btn btn-danger" id="'+o+'" onclick="reject(this)">提出举报</a></sapn></td>'
              +'<td style="display:none;" id="id'+o+'">'+data[o].id+'</td>'
             +'</tr>'
             +'</tr>').appendTo("#accept");
             // alert(data[o].id);
            }else if(data[o].status=="3"){
              $('<tr>'
              +'<td id="_id'+o+'">'+data[o]._id+'</td>'
              +'<td id="chId'+o+'">'+data[o].chId+'</td>'
              +'<td id="amount'+o+'">'+data[o].amount+'</td>'
              +'<td id="ciId'+o+'">'+data[o].ciId+'</td>'
              +'<td id="createAt'+o+'">'+moment(data[o].createAt).format('YYYY-MM-DD')+'</td>'
              +'<td id="reason'+o+'">'+data[o].reason+'</td>'
              +'<td id="comment'+o+'">'+data[o].comment+'</td>'
              +'<td>已接收</td>'
             +'</tr>'
             +'</tr>').appendTo("#allHandleRecord");
            }else if(data[o].status=="4"){
              $('<tr>'
              +'<td id="_id'+o+'">'+data[o]._id+'</td>'
              +'<td id="chId'+o+'">'+data[o].chId+'</td>'
              +'<td id="amount'+o+'">'+data[o].amount+'</td>'
              +'<td id="ciId'+o+'">'+data[o].ciId+'</td>'
              +'<td id="createAt'+o+'">'+moment(data[o].createAt).format('YYYY-MM-DD')+'</td>'
              +'<td id="reason'+o+'">'+data[o].reason+'</td>'
              +'<td id="comment'+o+'">'+data[o].comment+'</td>'
              +'<td>已举报</td>'
             +'</tr>'
             +'</tr>').appendTo("#allHandleRecord");
            }
          }
          if($("#accept").html()==""){
            $("#accept").html('<span style="color:#3c8dbc;">暂无低保帮扶记录。</span>');
          }
          if($("#allHandleRecord").html()==""){
            $("#allHandleRecord").html('<span style="color:#3c8dbc;">暂无低保帮扶记录。</span>');
          }
      }
  }).error(function(err){
      console.log(err);
      alert("错误："+err.responseText);
  });

});
  function agree(obj){
         var num=obj.id;//num=a0
         var pager='#choice'+num+'';
        $(pager).replaceWith('<span style="color:#00c0ef;">已确认收到此次捐赠</span>');
        var _rid="#_id"+num;
        var amount = "#amount"+num;
        var ChId = "#chId"+num;
        var id= "#id"+num;
       // alert(id+$(id).html()+$(amount).html());
        var postBody = {
            _id:$(_rid).html(),
            id:$(id).html(),
            appUserId:getCookie("userId"),
            amount:$(amount).html(),
            status:"3",
            ChId:$(ChId).html()
            };
        $.ajax({
            type: 'POST',
            url: 'http://localhost:3000/dbtest/lowincome/confirm',
            data: postBody,
            dataType: 'json',
            success: function(data){  
              console.log(data);
              alert("已确认收到此次捐赠！请到个人中心查看余额");
            }
         }).error(function(err){
            console.log(err);
            alert("服务器忙！请稍后再尝试");
          });
      }

  function reject(obj){
         var num=obj.id;//num=b0
         var pager='#choice'+num+'';
        $(pager).replaceWith('<span style="color:#d73925;">已选择举报此次捐赠行为</span>');
        var _rid="#_id"+num;
        var amount = "#amount"+num;
        var ChId = "#chId"+num;
        var postBody = {
            _id:$(_rid).html(),
            appUserId:getCookie("userId"),
            amount:$(amount).html(),
            status:"4",
            ChId:$(ChId).html()
            };
        $.ajax({
            type: 'POST',
            url: 'http://localhost:3000/dbtest/lowincome/confirm',
            data: postBody,
            dataType: 'json',
            success: function(data){  
              console.log(data);
              alert("已选择举报此次捐赠行为!");
            }
         }).error(function(err){
            console.log(err);
            alert("服务器忙！请稍后再尝试");
          });
      }
  </script>
</body>
</html>